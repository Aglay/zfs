#!/bin/bash
#
# zfs-zed
#
# chkconfig:    2345 01 99
# description:  This script will start and stop the ZFS Event Daemon.
# probe: true
#
### BEGIN INIT INFO
# Provides:          zfs-zed
# Required-Start:    mtab
# Required-Stop:     mtab
# Default-Start:     S
# Default-Stop:      0 1 6
# X-Start-Before:    checkfs
# X-Stop-After:      zfs-import
# Short-Description: ZFS Event Daemon
# Description:       zed monitors ZFS events. When a zevent is posted, zed
#                    will run any scripts that have been enabled for the
#                    corresponding zevent class.
### END INIT INFO

# Source the common init script
. @sysconfdir@/zfs/common.init

SVC_NAME="zfs-zed"
ZED_NAME="zed"
ZED_PIDFILE="@runstatedir@/$servicename.pid"

# Exit if the package is not installed
[ -x "$ZED" ] || exit 0

do_start()
{
	zfs_action $"Starting ZFS Event Daemon" zfs_daemon_start \
	    "$ZED_PIDFILE" "$ZED" "$ZED_ARGS"
	return $?
}

do_stop()
{
	zfs_action $"Stopping ZFS Event Daemon" zfs_daemon_stop \
	    "$ZED_PIDFILE" "$ZED" "$ZED_NAME"
	RETVAL=$?

	rm -f "$ZED_PIDFILE"

	return $RETVAL
}

do_status()
{
	zfs_daemon_status "$ZED" "$ZED_NAME"
	return $?
}

do_reload()
{
	zfs_action $"Reloading ZFS Event Daemon" zfs_daemon_reload \
	    "$PIDFILE" "$ZED_NAME"
	return $?
}

case "$1" in
	start)
		do_start
		;;

	stop)
		do_stop
		;;

	status)
		do_status
		;;

	reload)
		do_reload
		;;

	restart)
		do_stop
		do_start
		;;
	*)
		echo "Usage: $0 {start|stop|status|reload|restart}" >&2
		exit 1
		;;
esac

exit $?
